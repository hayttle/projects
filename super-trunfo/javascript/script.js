let cards = [
  {
    a1: {
      name: "HOMEM DE FERRO",
      image: "./images/cards/a1.jpg",
      attribute: {
        força: 5,
        velocidade: 6,
        habilidade: 2,
        equipamento: 5,
        inteligência: 6,
      },
    },
  },
  {
    a2: {
      name: "CAPITÃO AMÉRICA",
      image: "./images/cards/a2.jpg",
      attribute: {
        força: 3,
        velocidade: 2,
        habilidade: 6,
        equipamento: 2,
        inteligência: 3,
      },
    },
  },
  {
    a3: {
      name: "THOR",
      image: "./images/cards/a3.jpg",
      attribute: {
        força: 6,
        velocidade: 5,
        habilidade: 3,
        equipamento: 3,
        inteligência: 2,
      },
    },
  },
  {
    a4: {
      name: "HULK",
      image: "./images/cards/a4.jpg",
      attribute: {
        força: 6,
        velocidade: 5,
        habilidade: 4,
        equipamento: 1,
        inteligência: 1,
      },
    },
  },
  {
    a5: {
      name: "NICK FURY",
      image: "./images/cards/a5.jpg",
      attribute: {
        força: 1,
        velocidade: 2,
        habilidade: 4,
        equipamento: 6,
        inteligência: 3,
      },
    },
  },
  {
    a6: {
      name: "VIÚVA NEGRA",
      image: "./images/cards/a6.jpg",
      attribute: {
        força: 1,
        velocidade: 2,
        habilidade: 6,
        equipamento: 4,
        inteligência: 3,
      },
    },
  },
  {
    b1: {
      name: "GAVIÃO ARQUEIRO",
      image: "./images/cards/b1.jpg",
      attribute: {
        força: 1,
        velocidade: 1,
        habilidade: 6,
        equipamento: 5,
        inteligência: 2,
      },
    },
  },
  {
    b2: {
      name: "AGENTE HILL",
      image: "./images/cards/b2.jpg",
      attribute: {
        força: 1,
        velocidade: 1,
        habilidade: 4,
        equipamento: 5,
        inteligência: 3,
      },
    },
  },
  {
    b3: {
      name: "AGENTE COULSON",
      image: "./images/cards/b3.jpg",
      attribute: {
        força: 1,
        velocidade: 1,
        habilidade: 3,
        equipamento: 5,
        inteligência: 2,
      },
    },
  },
  {
    b4: {
      name: "TONY STARK",
      image: "./images/cards/b4.jpg",
      attribute: {
        força: 1,
        velocidade: 1,
        habilidade: 1,
        equipamento: 5,
        inteligência: 6,
      },
    },
  },
  {
    b5: {
      name: "BRUCE BANNER",
      image: "./images/cards/b5.jpg",
      attribute: {
        força: 1,
        velocidade: 1,
        habilidade: 1,
        equipamento: 3,
        inteligência: 6,
      },
    },
  },
  {
    b6: {
      name: "LOKI",
      image: "./images/cards/b6.jpg",
      attribute: {
        força: 5,
        velocidade: 4,
        habilidade: 4,
        equipamento: 5,
        inteligência: 5,
      },
    },
  },
  {
    c1: {
      name: "CHIRAURI",
      image: "./images/cards/c1.jpg",
      attribute: {
        força: 2,
        velocidade: 1,
        habilidade: 2,
        equipamento: 3,
        inteligência: 1,
      },
    },
  },
  {
    c2: {
      name: "LEVIATHAN",
      image: "./images/cards/c2.jpg",
      attribute: {
        força: 5,
        velocidade: 5,
        habilidade: 1,
        equipamento: 5,
        inteligência: 1,
      },
    },
  },
  {
    c3: {
      name: "CAVEIRA VERMELHA",
      image: "./images/cards/c3.jpg",
      attribute: {
        força: 3,
        velocidade: 2,
        habilidade: 4,
        equipamento: 4,
        inteligência: 3,
      },
    },
  },
  {
    c4: {
      name: "SOLDADOS HIDRA",
      image: "./images/cards/c4.jpg",
      attribute: {
        força: 2,
        velocidade: 1,
        habilidade: 2,
        equipamento: 4,
        inteligência: 2,
      },
    },
  },
  {
    c5: {
      name: "CHICOTE NEGRO",
      image: "./images/cards/c5.jpg",
      attribute: {
        força: 2,
        velocidade: 2,
        habilidade: 3,
        equipamento: 4,
        inteligência: 6,
      },
    },
  },
  {
    c6: {
      name: "MONGE DE FERRO",
      image: "./images/cards/c6.jpg",
      attribute: {
        força: 5,
        velocidade: 4,
        habilidade: 2,
        equipamento: 5,
        inteligência: 4,
      },
    },
  },
  {
    d1: {
      name: "GIGANTE DE GELO",
      image: "./images/cards/d1.jpg",
      attribute: {
        força: 4,
        velocidade: 3,
        habilidade: 3,
        equipamento: 2,
        inteligência: 2,
      },
    },
  },
  {
    d2: {
      name: "ABOMINÁVEL",
      image: "./images/cards/d2.jpg",
      attribute: {
        força: 6,
        velocidade: 3,
        habilidade: 3,
        equipamento: 1,
        inteligência: 3,
      },
    },
  },
  {
    d3: {
      name: "HEIMDALL",
      image: "./images/cards/d3.jpg",
      attribute: {
        força: 4,
        velocidade: 3,
        habilidade: 3,
        equipamento: 3,
        inteligência: 2,
      },
    },
  },
  {
    d4: {
      name: "EMIL BLONSK",
      image: "./images/cards/d4.jpg",
      attribute: {
        força: 2,
        velocidade: 3,
        habilidade: 5,
        equipamento: 2,
        inteligência: 3,
      },
    },
  },
  {
    d5: {
      name: "HOWARD STARK",
      image: "./images/cards/d5.jpg",
      attribute: {
        força: 1,
        velocidade: 1,
        habilidade: 2,
        equipamento: 4,
        inteligência: 6,
      },
    },
  },
  {
    d6: {
      name: "WAR MACHINE",
      image: "./images/cards/d6.jpg",
      attribute: {
        força: 5,
        velocidade: 5,
        habilidade: 2,
        equipamento: 5,
        inteligência: 3,
      },
    },
  },
  {
    e1: {
      name: "HOMEM DE FERRO - Mark V",
      image: "./images/cards/e1.jpg",
      attribute: {
        força: 5,
        velocidade: 4,
        habilidade: 2,
        equipamento: 4,
        inteligência: 6,
      },
    },
  },
  {
    e2: {
      name: "ODIN",
      image: "./images/cards/e2.jpg",
      attribute: {
        força: 5,
        velocidade: 2,
        habilidade: 1,
        equipamento: 6,
        inteligência: 6,
      },
    },
  },
  {
    e3: {
      name: "SIF",
      image: "./images/cards/e3.jpg",
      attribute: {
        força: 4,
        velocidade: 2,
        habilidade: 4,
        equipamento: 3,
        inteligência: 3,
      },
    },
  },
  {
    e4: {
      name: "DUM DUM DUGAN",
      image: "./images/cards/e4.jpg",
      attribute: {
        força: 1,
        velocidade: 2,
        habilidade: 3,
        equipamento: 2,
        inteligência: 2,
      },
    },
  },
  {
    e5: {
      name: "BUCKY BARNES",
      image: "./images/cards/e5.jpg",
      attribute: {
        força: 1,
        velocidade: 2,
        habilidade: 3,
        equipamento: 3,
        inteligência: 3,
      },
    },
  },
  {
    e6: {
      name: "DESTRUIDOR",
      image: "./images/cards/e6.jpg",
      attribute: {
        força: 6,
        velocidade: 4,
        habilidade: 3,
        equipamento: 3,
        inteligência: 1,
      },
    },
  },
];

let selectCountCards = document.getElementById("countCards");
let btnGiveCards = document.getElementById("giveCards");
let divCardPlayer = document.getElementById("cardPlayer");
let divCardMachine = document.getElementById("cardMachine");
let divOptions = document.getElementById("options");
let btnNextCard = document.getElementById("btnNextCard");
let btnViewCards = document.getElementById("viewCards");
let btnRestart = document.getElementById("restart");
let btnPlay = document.getElementById("play");
let divResults = document.getElementById("results");
let cardPlayer, cardMachine, imgCardMachine, cardsPlayer, cardsMachine;
let givenCards = false;
let countCards = "";
let newCards = [];

selectCountCards.addEventListener("change", () => {
  countCards = selectCountCards.value;
});

function giveCards() {
  if (countCards == "") {
    alert("Escolha a quantidade de cartas para jogar!");
    return false;
  }

  if (!givenCards) {
    contentHTML = "";
    results.innerHTML = "";

    for (let i = 0; i < countCards; i++) {
      let idx = Math.floor(Math.random() * cards.length);
      newCards.push(cards[idx]);
      cards.splice(idx, 1);
    }
    cards = newCards;
    cardsPlayer = [];
    cardsMachine = [...cards];
    let n = cards.length / 2;
    let interate = cards.length;
    for (i = 0; i < n; i++) {
      let idx = Math.floor(Math.random() * interate);
      cardsPlayer.push(cardsMachine.splice(idx, 1)[0]);
      interate--;
    }
    results.setAttribute("class", "");
    results.innerHTML = countCards + " cartas distribuídas.<br>Vamos jogar!";
    btnGiveCards.style.display = "none";
    btnViewCards.style.display = "block";
    selectCountCards.disabled = true;

    givenCards = true;
  } else {
    alert("Cartas já foram distribuídas!");
  }
}

function getCardPlayer() {
  index = 0;
  cardPlayer = cardsPlayer[index];
  return cardPlayer;
}

function getCardMachine() {
  index = 0;
  cardMachine = cardsMachine[index];
  return cardMachine;
}

function nextCardPlayer() {
  cardPlayer = getCardPlayer();

  contentHTML = "";
  optionsHTML = "";
  results.innerHTML = "";
  results.setAttribute("class", "");
  for (let element in cardPlayer) {
    data = cardPlayer[element];

    contentHTML += `
      <img src="${data.image}" id="imgCardPlayer">
      `;
    optionsHTML = `
      <h2 class="titlePower">Escolha seu poder!</h2>
      `;
    for (let attribute in data.attribute) {
      optionsHTML += `<p class="attribute">
        <input type="radio" id="${attribute}" name="atributo" value="${attribute}"><label for="${attribute}">${attribute}</label>
        </p>
        `;
    }
    optionsHTML += `
    <div class="countUpdatedCards">
      <h1>Cartas</h1>
      <h2>${cardsPlayer.length} X ${cardsMachine.length}</h2>
    <div>
    `;
  }
  viewCardMachine();
  divCardPlayer.innerHTML = contentHTML;
  divOptions.innerHTML = optionsHTML;
  btnNextCard.style.display = "none";
  btnPlay.style.display = "block";
}

function viewCardMachine() {
  let contentHTML;
  cardMachine = getCardMachine();

  for (let element in cardMachine) {
    data = cardMachine[element];

    contentHTML = `
      <img src="${data.image}" class="blured" id="imgCardMachine">
      `;
  }
  divCardMachine.innerHTML = contentHTML;
}

function viewCards() {
  if (!givenCards) {
    alert("Primeiro distribua as cartas");
  } else {
    nextCardPlayer();
    viewCardMachine();
    btnPlay.style.display = "block";
    btnViewCards.style.display = "none";
  }
}

function play() {
  results.setAttribute("class", "");
  let powerPlayer;
  let powerMachine;
  let attribute;
  let status;

  let initialsPlayer = ["b", "c", "d", "e"].some((word) =>
    Object.keys(cardPlayer)[0].startsWith(word)
  );

  let initialsMachine = ["b", "c", "d", "e"].some((word) =>
    Object.keys(cardMachine)[0].startsWith(word)
  );

  if (Object.keys(cardPlayer)[0] == "a1" && initialsMachine) {
    status = "Você venceu com a carta Super Trunfo";
    results.classList.add("wonMatch");
    const element = cardsPlayer.splice(0, 1)[0];
    cardsPlayer.splice(cardsPlayer.length, 0, element);
    cardsPlayer.push(cardsMachine.splice(0, 1)[0]);
  } else if (initialsPlayer && Object.keys(cardMachine)[0] == "a1") {
    status = "Você perdeu para a carta Super Trunfo";
    results.classList.add("loseMatch");
    const element = cardsMachine.splice(0, 1)[0];
    cardsMachine.splice(cardsMachine.length, 0, element);
    cardsMachine.push(cardsPlayer.splice(0, 1)[0]);
  } else {
    input = document.getElementsByName("atributo");
    input.forEach((element) => {
      if (element.checked) {
        attribute = element.value;
      }
    });
    if (!attribute) {
      alert("Escolha seu poder!");
    } else {
      for (let attrib in cardPlayer) {
        powerPlayer = cardPlayer[attrib].attribute[attribute];
      }

      for (let attrib in cardMachine) {
        powerMachine = cardMachine[attrib].attribute[attribute];
      }

      if (powerPlayer > powerMachine) {
        status = "Você ganhou!";
        results.classList.add("wonMatch");

        const element = cardsPlayer.splice(0, 1)[0];
        cardsPlayer.splice(cardsPlayer.length, 0, element);
        cardsPlayer.push(cardsMachine.splice(0, 1)[0]);
      } else if (powerPlayer < powerMachine) {
        status = "Você perdeu!";
        results.classList.add("loseMatch");

        const element = cardsMachine.splice(0, 1)[0];
        cardsMachine.splice(cardsMachine.length, 0, element);
        cardsMachine.push(cardsPlayer.splice(0, 1)[0]);
      } else {
        status = "Empatou!";
        results.classList.add("tiedMatch");

        const elem = cardsPlayer.splice(0, 1)[0];
        cardsPlayer.splice(cardsPlayer.length, 0, elem);

        const element = cardsMachine.splice(0, 1)[0];
        cardsMachine.splice(cardsMachine.length, 0, element);
      }
    }
  }

  imgCardMachine = document.getElementById("imgCardMachine");
  imgCardMachine.classList.remove("blured");
  btnPlay.style.display = "none";
  if (cardsPlayer.length == 0) {
    status = "Você perdeu a partida!";
    divOptions.style.display = "none";
    document.getElementById("middle").style.justifyContent = "center";
    results.classList.add("loseMatch");
    btnRestart.style.display = "block";
  } else if (cardsMachine.length == 0) {
    status = "Parabéns, você venceu a partida!";
    divOptions.style.display = "none";
    document.getElementById("middle").style.justifyContent = "center";
    results.classList.add("wonMatch");
    btnRestart.style.display = "block";
  } else {
    btnNextCard.style.display = "block";
  }

  divResults.innerHTML = status;
}
